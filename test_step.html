<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Step-by-Step Progression</title>
</head>
<body>
    <h1>Testing Step-by-Step Progression</h1>
    <pre id="output"></pre>
    
    <script type="module">
        import init, { WasmUniverse } from './pkg/vive_hashlife.js';
        
        async function test() {
            await init();
            const output = document.getElementById('output');
            
            // Create a universe
            const universe = new WasmUniverse(16);
            
            // Create a blinker pattern
            universe.setCell(0, 0, true);
            universe.setCell(1, 0, true);
            universe.setCell(2, 0, true);
            
            let log = "Initial state (generation " + universe.generation() + "):\n";
            log += "Population: " + universe.population() + "\n";
            for (let y = -1; y <= 1; y++) {
                for (let x = -1; x <= 3; x++) {
                    log += universe.getCell(x, y) ? "█" : ".";
                }
                log += "\n";
            }
            
            // Step 1
            universe.step();
            log += "\nAfter step 1 (generation " + universe.generation() + "):\n";
            log += "Population: " + universe.population() + "\n";
            for (let y = -1; y <= 1; y++) {
                for (let x = -1; x <= 3; x++) {
                    log += universe.getCell(x, y) ? "█" : ".";
                }
                log += "\n";
            }
            
            // Step 2
            universe.step();
            log += "\nAfter step 2 (generation " + universe.generation() + "):\n";
            log += "Population: " + universe.population() + "\n";
            for (let y = -1; y <= 1; y++) {
                for (let x = -1; x <= 3; x++) {
                    log += universe.getCell(x, y) ? "█" : ".";
                }
                log += "\n";
            }
            
            log += "\n✓ Test passed! Each step advances by exactly 1 generation.";
            output.textContent = log;
        }
        
        test().catch(e => {
            document.getElementById('output').textContent = "Error: " + e;
        });
    </script>
</body>
</html>
